---
filename: PRD-external-suggestion-integration.md
source-format: md
source-language: auto
target-language: ru-RU
line-fist: 1
line-last: 360
total-lines: 360
---

# PRD: Интеграция внешних AI-рекомендаций
> Product Requirement Document

## 1. Обзор

### 1.1 Предыстория
После того как пользователи написали 10 глав в Novel Writer, они хотят получать рекомендации по написанию от других AI-инструментов (например, Gemini, ChatGPT и т. д.) и элегантно интегрировать эти рекомендации в существующие правила создания контента (spec), чтобы постоянно улучшать качество произведения.

### 1.2 Цели
- Предоставить стандартизированный механизм интеграции внешних рекомендаций
- Сохранять простоту системы, не добавляя ненужных команд
- Обеспечить отслеживаемость рекомендаций и управление версиями
- Гарантировать стандартизацию и возможность парсинга формата рекомендаций

### 1.3 Ценностное предложение
- **Повышение качества произведения**: Сотрудничество нескольких AI для взаимодополнения сильных сторон.
- **Сохранение связности творчества**: Автоматическая интеграция рекомендаций в правила.
- **Повышение эффективности**: Стандартизированный процесс, сокращение ручных операций.

## 2. Дизайн функций

### 2.1 Основная функция
Расширить существующую команду `/constitution`, добавив подкоманду `refine`:
```
/constitution refine [содержание рекомендации]
```

### 2.2 Процесс работы функции
```mermaid
graph LR
    A[Автор завершает N глав] --> B[Анализ с помощью внешнего AI]
    B --> C[Получение структурированных рекомендаций]
    C --> D[Копирование рекомендаций в Claude Code]
    D --> E[Выполнение /constitution refine]
    E --> F[Парсинг рекомендаций системой]
    F --> G[Интеллектуальное слияние в spec]
    G --> H[Генерация отчета об улучшениях]
    H --> I[Продолжение написания]
```

### 2.3 Обработка рекомендаций по категориям

| Тип рекомендации | Целевой файл | Способ обработки |
|---------|---------|----------|
| Стиль письма | `.specify/memory/writing-constitution.md` | Слияние в соответствующую главу |
| Оптимизация персонажа | `spec/knowledge/character-profiles.md` | Обновление профиля персонажа |
| Рекомендации по сюжету | `spec/tracking/plot-tracker.json` | Добавление нового узла |
| Дополнение мировоззрения | `spec/knowledge/world-setting.md` | Расширение сеттинга |
| Корректировка темпа | `.specify/memory/writing-constitution.md` | Обновление стандартов качества |

## 3. Спецификация вывода сторонних AI

### 3.1 Стандартный формат рекомендаций
Сторонний AI должен выводить рекомендации в следующем формате JSON:

```json
{
  "version": "1.0",
  "source": "Gemini Pro",
  "analysis_date": "2025-01-24",
  "chapters_analyzed": {
    "start": 1,
    "end": 10,
    "total_words": 42000
  },
  "suggestions": {
    "style": {
      "priority": "high",
      "items": [
        {
          "type": "narrative_voice",
          "current": "Третье лицо, всеведущий рассказчик, присутствуют скачки",
          "suggestion": "Сохранять единую точку зрения, рекомендуется зафиксировать на точке зрения главного героя",
          "examples": ["Глава 3, абзац 2", "Начало главы 7"],
          "impact": "Повышение связности повествования"
        },
        {
          "type": "pacing",
          "current": "Темп в главах 5-7 слишком напряженный",
          "suggestion": "Добавить переходные абзацы, чтобы дать читателю передышку",
          "examples": ["Сразу после боя в главе 6 начинается следующий конфликт"],
          "impact": "Улучшение читательского опыта"
        }
      ]
    },
    "characters": {
      "priority": "medium",
      "items": [
        {
          "character": "Главная героиня",
          "issue": "Слишком быстрая смена характера",
          "suggestion": "Добавить психологическое описание между главами 4 и 8",
          "development_curve": "Постепенный рост",
          "chapters_affected": [4, 5, 6, 7, 8]
        }
      ]
    },
    "plot": {
      "priority": "low",
      "items": [
        {
          "type": "foreshadowing",
          "location": "Завязка, заложенная в главе 3",
          "status": "не разрешена",
          "suggestion": "Рекомендуется разрешить до главы 15",
          "importance": "medium"
        }
      ]
    },
    "worldbuilding": {
      "priority": "medium",
      "items": [
        {
          "aspect": "Система магии",
          "issue": "Правила недостаточно ясны",
          "suggestion": "Добавить источник энергии и условия ограничения",
          "reference_chapters": [2, 5, 9]
        }
      ]
    },
    "dialogue": {
      "priority": "high",
      "items": [
        {
          "character": "Главный герой",
          "issue": "Слишком современная лексика",
          "suggestion": "Перевести на язык, соответствующий древнему сеттингу",
          "examples": ["OK", "Нет проблем", "Готово"],
          "alternatives": ["Хорошо", "Не беда", "Сделано"]
        }
      ]
    }
  },
  "overall_rating": {
    "plot_coherence": 8,
    "character_development": 7,
    "world_building": 6,
    "writing_style": 7,
    "reader_engagement": 8
  },
  "key_improvements": [
    "Единая точка зрения повествования",
    "Усиление психологического описания персонажа",
    "Улучшение сеттинга мира"
  ]
}
```

### 3.2 Шаблон подсказки (для стороннего AI)

```markdown
# Задача анализа написания романа

Проанализируйте первые 10 глав предоставленного мной романа и выведите рекомендации в следующем формате JSON.

## Требования к выводу
1. Обязательно использовать строго JSON-формат.
2. Все рекомендации должны быть конкретизированы по главам.
3. Предоставить практические предложения по улучшению.
4. Указать приоритет (high/medium/low).

## Описание структуры JSON
- version: Фиксированное значение "1.0".
- source: Название вашего AI.
- analysis_date: Формат YYYY-MM-DD.
- chapters_analyzed: Диапазон анализируемых глав.
- suggestions: Рекомендации по категориям
  - style: Рекомендации по стилю письма.
  - characters: Рекомендации по развитию персонажей.
  - plot: Рекомендации по развитию сюжета.
  - worldbuilding: Рекомендации по мировоззрению.
  - dialogue: Рекомендации по оптимизации диалогов.
- overall_rating: Оценки по каждому аспекту (1-10).
- key_improvements: 3 наиболее важных пункта для улучшения.

## Пример вывода
[Вставьте сюда пример JSON выше]

Пожалуйста, выводите строго в соответствии с этим форматом, чтобы обеспечить возможность программного парсинга.
```

### 3.3 Упрощенный формат (версия Markdown)
Если пользователь не может получить формат JSON, можно использовать структурированный Markdown:

```markdown
# Отчет о рекомендациях по написанию романа

## Основная информация
- Инструмент анализа: Gemini Pro
- Дата анализа: 2025-01-24
- Диапазон анализа: Главы 1-10, всего 42000 слов

## Рекомендации по стилю письма [Высокий приоритет]

### Точка зрения повествования
- **Проблема**: Третье лицо, всеведущий рассказчик, присутствуют скачки.
- **Рекомендация**: Сохранять единую точку зрения, зафиксировать на точке зрения главного героя.
- **Примеры**: Глава 3, абзац 2; Начало главы 7.
- **Ожидаемый результат**: Повышение связности повествования.

### Контроль темпа
- **Проблема**: Темп в главах 5-7 слишком напряженный.
- **Рекомендация**: Добавить переходные абзацы.
- **Примеры**: Сразу после боя в главе 6 начинается следующий конфликт.
- **Ожидаемый результат**: Улучшение читательского опыта.

## Рекомендации по оптимизации персонажей [Средний приоритет]

### Главная героиня
- **Проблема**: Слишком быстрая смена характера.
- **Рекомендация**: Добавить психологическое описание между главами 4 и 8.
- **Кривая развития**: Постепенный рост.
- **Затронутые главы**: 4, 5, 6, 7, 8.

## Рекомендации по развитию сюжета [Низкий приоритет]

### Управление завязками
- **Место**: Завязка, заложенная в главе 3.
- **Статус**: Не разрешена.
- **Рекомендация**: Разрешить до главы 15.
- **Важность**: Средняя.

## Рекомендации по мировоззрению [Средний приоритет]

### Система магии
- **Проблема**: Правила недостаточно ясны.
- **Рекомендация**: Добавить источник энергии и условия ограничения.
- **Справочные главы**: 2, 5, 9.

## Рекомендации по оптимизации диалогов [Высокий приоритет]

### Лексика главного героя
- **Проблема**: Слишком современная.
- **Заменить**: OK → Хорошо, Нет проблем → Не беда, Готово → Сделано.
- **Принцип**: Соответствие древнему сеттингу.

## Общая оценка
- Связность сюжета: 8/10
- Развитие персонажей: 7/10
- Построение мира: 6/10
- Стиль письма: 7/10
- Вовлеченность читателя: 8/10

## Три ключевых улучшения
1. Единая точка зрения повествования.
2. Усиление психологического описания персонажа.
3. Улучшение сеттинга мира.
```

## 4. Техническая реализация

### 4.1 Расширение команды
Изменить `templates/commands/constitution.md`:
```yaml
---
description: Установка и оптимизация стиля написания романа
scripts:
  sh: .specify/scripts/bash/constitution-manager.sh
---

Использование:
1. /constitution - Инициализация стиля написания
2. /constitution refine [Рекомендация] - Интеграция внешних рекомендаций
```

### 4.2 Парсер рекомендаций
Создать `.specify/scripts/bash/parse-suggestions.sh`:
```bash
#!/bin/bash
# Парсинг рекомендаций в формате JSON или Markdown
# Автоматическое определение формата
# Извлечение ключевой информации
# Генерация инструкций по обновлению
```

### 4.3 Хранение данных
Добавить файлы:
- `spec/knowledge/improvement-log.md` - Журнал истории рекомендаций
- `spec/knowledge/suggestion-templates/` - Библиотека шаблонов рекомендаций
- `.specify/memory/refinement-history.json` - История улучшений

## 5. Пользовательский опыт

### 5.1 Процесс использования
1. **Получение рекомендаций**
   ```
   Пользователь: Проанализируй мои первые 10 глав романа и дай рекомендации по улучшению.
   Gemini: [Возврат структурированных рекомендаций]
   ```

2. **Копирование рекомендаций**
   Скопировать полный вывод Gemini.

3. **Выполнение интеграции**
   ```
   /constitution refine """
   [Вставить содержание рекомендаций]
   """
   ```

4. **Просмотр отчета**
   ```
   ✅ Интеграция рекомендаций завершена.
   - Обновлено правил написания: 3 пункта.
   - Оптимизировано настроек персонажей: 2 пункта.
   - Дополнено мировоззрение: 1 пункт.
   Подробности см. в: spec/knowledge/improvement-log.md
   ```

### 5.2 Обработка ошибок
- Ошибка формата: Предоставить подсказку по исправлению формата.
- Конфликтующие рекомендации: Отметить для ручного подтверждения.
- Повторяющиеся рекомендации: Автоматическое удаление дубликатов.

## 6. Показатели успеха

### 6.1 Функциональные показатели
- Успешность парсинга рекомендаций > 95%
- Точность автоматической интеграции > 90%
- Время обработки < 3 секунд

### 6.2 Пользовательские показатели
- Коэффициент принятия рекомендаций > 70%
- Повышение качества произведения (на основе последующих отзывов)
- Удовлетворенность пользователей > 8/10

## 7. Будущее развитие

### 7.1 Фаза 2
- Поддержка сравнения рекомендаций от нескольких AI.
- Автоматический расчет веса рекомендаций.
- A/B тестирование эффективности различных рекомендаций.

### 7.2 Фаза 3
- Отслеживание эффективности рекомендаций.
- Оптимизация принятия рекомендаций с помощью машинного обучения.
- Персонализированный фильтр рекомендаций.

## 8. Риски и меры противодействия

| Риск | Влияние | Мера противодействия |
|-----|------|-----|
| Качество рекомендаций неравномерное | Влияет на творчество | Предоставить механизм оценки рекомендаций |
| Несогласованность форматов | Ошибка парсинга | Совместимость с несколькими форматами + обработка ошибок |
| Чрезмерная зависимость от внешних рекомендаций | Потеря индивидуального стиля | Контроль степени принятия рекомендаций |

## 9. Приложения

### 9.1 Связанные документы
- [Руководство по методам написания](../spec/knowledge/writing-methods-guide.md)
- [Описание системы команд](./command-system.md)
- [Документация системы отслеживания](./tracking-system.md)

### 9.2 История версий
- v1.0 (2025-01-24): Начальная версия.

---
*Статус документа: Черновик*
*Автор: Novel Writer Team*
*Последнее обновление: 2025-01-24*