---
description: 对作品进行综合验证和分析
scripts:
  sh: .specify/scripts/bash/analyze-story.sh
  ps: .specify/scripts/powershell/analyze-story.ps1
---

Провести комплексный анализ завершенного контента истории для проверки соответствия конституции, спецификациям и плану.

## Цели

Провести всестороннюю проверку произведения, подобно ревью кода, для обеспечения качества и согласованности.

## Шаги выполнения

### 1. Загрузка эталонов для проверки

Запустите `{SCRIPT}` для загрузки всех эталонных документов для проверки:
- Файл конституции: `memory/novel-constitution.md`
- Файлы спецификаций: `stories/*/specification.md`
- Файлы творческих планов: `stories/*/creative-plan.md`
- Список задач: `stories/*/tasks.md`
- Завершенный контент: `stories/*/content/*.md`

### 2. Проверка соответствия конституции

Проверьте, соответствует ли произведение принципам конституции творчества:

```markdown
## Отчет о соответствии конституции

### Проверка основных ценностей
- [ ] Принцип 1: [Результат проверки]
- [ ] Принцип 2: [Результат проверки]
- [ ] Принцип 3: [Результат проверки]

### Проверка стандартов качества
- [ ] Логическая согласованность: [Пройдено/Предупреждение/Провал]
- [ ] Полнота персонажей: [Оценка]
- [ ] Качество текста: [Оценка]

### Соответствие стиля
- [ ] Стиль повествования: [Соответствует/Отклонение]
- [ ] Языковой стиль: [Соответствует/Отклонение]
- [ ] Контроль темпа: [Соответствует/Отклонение]
```

### 3. Анализ соответствия спецификациям

Проверьте, соответствуют ли реализации требованиям спецификаций:

```markdown
## Анализ соответствия спецификациям

### Охват основных требований
#### P0 (обязательно включить)
- [Требование 1]: ✅ Реализовано
- [Требование 2]: ⚠️ Частично реализовано
- [Требование 3]: ❌ Не реализовано

#### P1 (следует включить)
[Покрытие: X%]

#### P2 (можно включить)
[Покрытие: X%]

### Достижение целей
- Адаптация под целевую аудиторию: [X%]
- Соответствие рыночному позиционированию: [X%]
- Достижение критериев успеха: [X/Y]

### Соблюдение ограничений
- Красные линии контента: ✅ Нарушений нет
- Творческие ограничения: ✅ Соответствует требованиям
- Технические ограничения: ⚠️ [Конкретная проблема]
```

### 4. Анализ выполнения плана

Оцените отклонения фактического выполнения от плана:

```markdown
## Анализ выполнения плана

### Сравнение структуры глав
| План | Факт | Анализ отклонений |
|------|------|-------------------|
| Глава 1: Завязка | ✅ Завершено | Соответствует ожиданиям |
| Глава 2: Развитие конфликта | ✅ Завершено | Незначительные корректировки |
| Глава 3: Поворотный момент | ⚠️ В процессе | Отложено на 1 главу |

### Траектории развития персонажей
- Дуга роста главного героя: [Соответствие X%]
- Функции второстепенных персонажей: [Степень реализации X%]
- Эволюция отношений: [Соответствие X%]

### Развитие мира
- Первый уровень сеттинга: ✅ Развернуто по плану
- Второй уровень сеттинга: ⚠️ Раскрыто преждевременно
- Третий уровень сеттинга: [Не достигнуто]
```

### 5. Анализ качества контента

Углубленный анализ качества произведения:

```markdown
## Анализ качества контента

### Статистика текста
- Общий объем: [X] слов
- Средняя длина главы: [X] слов
- Прогресс выполнения: [X%]

### Структурный анализ
- Плотность сюжета: [Высокая/Средняя/Низкая]
- Частота конфликтов: [X раз/глава]
- Изменение темпа: [График]

### Технические проблемы
#### Логические проблемы
1. [Местоположение]: [Описание проблемы]
2. [Местоположение]: [Описание проблемы]

#### Проблемы связности
1. [Местоположение]: [Описание проблемы]

#### Соответствие персонажей
1. [Персонаж]: [Противоречие в поведении]

### Выявление сильных сторон
1. [Местоположение]: [Сильные стороны]
2. [Местоположение]: [Инновационные моменты]
```

### 6. Аудит завершенности задач

Проверьте выполнение задач:

```markdown
## Завершенность задач

### Общий прогресс
- Всего задач: [X]
- Завершено: [Y]
- В процессе: [Z]
- Не начато: [W]

### Ключевые вехи
- [Веха 1]: ✅ Достигнуто
- [Веха 2]: ⚠️ Задержка
- [Веха 3]: [Не определено]

### Блокировки и риски
1. [Блокирующий фактор]: [Анализ влияния]
2. [Риск]: [Предложения по реагированию]
```

### 7. Генерация предложений по улучшению

Предоставьте конкретные предложения на основе результатов анализа:

```markdown
## Предложения по улучшению

### Срочные исправления (P0)
1. **[Проблема]**
   - Влияние: [Описание влияния]
   - Предложение: [Конкретное решение]
   - Местоположение: [Конкретная глава/параграф]

### Рекомендации по оптимизации (P1)
1. **[Пункт оптимизации]**
   - Текущее состояние: [Текущее положение дел]
   - Предложение: [План оптимизации]
   - Ожидаемый результат: [Эффект улучшения]

### Долгосрочные улучшения (P2)
1. **[Направление улучшения]**
   - Обоснование: [Почему необходимо]
   - План: [Как реализовать]
   - Сроки: [Когда реализовать]
```

### 8. Генерация отчета о проверке

Создайте файл `stories/*/analysis-report.md`:

```markdown
# Отчет об анализе произведения

## Резюме
- Дата анализа: [YYYY-MM-DD]
- Версия произведения: [Версия произведения]
- Общая оценка: [X/10]
- Рекомендуемые действия: [Продолжить/Доработать/Переписать]

## Ключевые метрики
| Измерение | Оценка | Описание |
|------|------|------|
| Соответствие конституции | X/10 | [Описание] |
| Соответствие спецификациям | X/10 | [Описание] |
| Выполнение плана | X/10 | [Описание] |
| Качество контента | X/10 | [Описание] |
| Читательский опыт | X/10 | [Прогноз] |

## Ключевые выводы
[3-5 наиболее важных выводов]

## Следующие шаги
[Конкретные действия на основе анализа]
```

### 9. Интерактивное улучшение

Предоставьте интерактивные опции:
- Просмотр деталей конкретных проблем
- Генерация задач по исправлению
- Обновление плана
- Корректировка спецификаций

### 10. Постоянный мониторинг

Настройте механизм контроля качества:
- Автоматический анализ каждые 5 завершенных глав
- Принудительный анализ на ключевых этапах
- Отслеживание тенденций качества

## Структура измерений анализа

### Семь измерений анализа
1. **Соответствие**: Соответствие конституции и спецификациям
2. **Согласованность**: Логика, персонажи, мир
3. **Полнота**: Охват требований, завершенность задач
4. **Качество**: Текст, структура, темп
5. **Инновационность**: Сильные стороны, особенности, прорывы
6. **Читабельность**: Плавность, увлекательность, резонанс
7. **Осуществимость**: Прогресс, ресурсы, риски

## Критерии оценки

```
10 баллов: Идеально, превзошло ожидания
8-9 баллов: Отлично, незначительные недочеты
6-7 баллов: Хорошо, требуется оптимизация
4-5 баллов: Удовлетворительно, много проблем
1-3 балла: Плохо, требуется переписывание
```

## Связь с другими командами

- **Входные данные**: Все предыдущие документы + фактический контент
- **Выходные данные**: Отчет об анализе + предложения по улучшению
- **Триггеры**: Может инициировать обновление задач, корректировку планов

## Примечания

### Объективный анализ
- Основывайтесь на данных и стандартах
- Избегайте субъективных суждений
- Предоставляйте конкретные доказательства

### Конструктивная обратная связь
- Точно определяйте проблемы
- Предложения должны быть выполнимы
- Сохраняйте позитивный настрой

### Постоянное совершенствование
- Анализ проводится для улучшения
- Записывайте результаты каждого анализа
- Отслеживайте эффект от улучшений

Помните: **Цель анализа — улучшить произведение, а не критиковать его.**
---