---
description: Комплексная проверка и анализ произведения
scripts:
  sh: .specify/scripts/bash/analyze-story.sh
  ps: .specify/scripts/powershell/analyze-story.ps1
---

Проведение комплексного анализа завершённого содержания истории для проверки соответствия конституции, спецификациям и плану.

## Цели

Всесторонняя проверка произведения, подобно ревью кода, для обеспечения качества и согласованности.

## Шаги выполнения

### 1. Загрузка эталонных документов для проверки

Запустите `{SCRIPT}` для загрузки всех эталонных документов:
- Файл конституции: `memory/novel-constitution.md`
- Файлы спецификаций: `stories/*/specification.md`
- Файлы планов: `stories/*/creative-plan.md`
- Список задач: `stories/*/tasks.md`
- Завершённое содержание: `stories/*/content/*.md`

### 2. Проверка соответствия конституции

Проверка соответствия произведения принципам конституции творчества:

```markdown
## Отчёт о соответствии конституции

### Проверка основных ценностей
- [ ] Принцип 1: [Результат проверки]
- [ ] Принцип 2: [Результат проверки]
- [ ] Принцип 3: [Результат проверки]

### Оценка стандартов качества
- [ ] Логическая согласованность: [Пройдено/Предупреждение/Провал]
- [ ] Полнота персонажей: [Оценка]
- [ ] Качество текста: [Оценка]

### Соответствие стиля
- [ ] Стиль повествования: [Соответствует/Отклонение]
- [ ] Языковой стиль: [Соответствует/Отклонение]
- [ ] Контроль темпа: [Соответствует/Отклонение]
```

### 3. Анализ соответствия спецификациям

Проверка соответствия реализации требованиям спецификаций:

```markdown
## Анализ соответствия спецификациям

### Охват основных требований
#### P0 (обязательно к включению)
- [Требование 1]: ✅ Реализовано
- [Требование 2]: ⚠️ Частично реализовано
- [Требование 3]: ❌ Не реализовано

#### P1 (следует включить)
[Покрытие: X%]

#### P2 (можно включить)
[Покрытие: X%]

### Достижение целей
- Соответствие целевой аудитории: [X%]
- Соответствие рыночному позиционированию: [X%]
- Достижение критериев успеха: [X/Y]

### Соблюдение ограничений
- Контентные ограничения: ✅ Нет нарушений
- Творческие ограничения: ✅ Соответствует требованиям
- Технические ограничения: ⚠️ [Конкретная проблема]
```

### 4. Анализ выполнения плана

Оценка отклонений фактического выполнения от плана:

```markdown
## Анализ выполнения плана

### Сравнение структуры глав
| План | Факт | Анализ отклонений |
|------|------|-------------------|
| Глава 1: Завязка | ✅ Завершено | Соответствует ожиданиям |
| Глава 2: Развитие конфликта | ✅ Завершено | Небольшие корректировки |
| Глава 3: Поворотный момент | ⚠️ В процессе | Сдвинуто на 1 главу |

### Траектория развития персонажей
- Дуга роста главного героя: [Соответствие X%]
- Функциональность второстепенных персонажей: [Степень реализации X%]
- Эволюция отношений: [Соответствие X%]

### Развитие мира
- Первый уровень сеттинга: ✅ Развёрнуто по плану
- Второй уровень сеттинга: ⚠️ Раскрыто преждевременно
- Третий уровень сеттинга: [Не достигнуто]
```

### 5. Анализ качества контента

Глубокий анализ качества произведения:

```markdown
## Анализ качества контента

### Статистика текста
- Общее количество символов: [X]
- Средняя длина главы: [X] символов
- Прогресс завершения: [X%]

### Структурный анализ
- Плотность сюжета: [Высокая/Средняя/Низкая]
- Частота конфликтов: [X раз/глава]
- Изменение темпа: [График]

### Технические проблемы
#### Логические проблемы
1. [Местоположение]: [Описание проблемы]
2. [Местоположение]: [Описание проблемы]

#### Проблемы связности
1. [Местоположение]: [Описание проблемы]

#### Соответствие персонажей
1. [Персонаж]: [Противоречие в поведении]

### Выявление сильных сторон
1. [Местоположение]: [Сильные стороны]
2. [Местоположение]: [Инновационные моменты]
```

### 6. Аудит выполнения задач

Проверка выполнения задач:

```markdown
## Выполнение задач

### Общий прогресс
- Всего задач: [X]
- Завершено: [Y]
- В процессе: [Z]
- Не начато: [W]

### Ключевые этапы
- [Этап 1]: ✅ Достигнуто
- [Этап 2]: ⚠️ Задержка
- [Этап 3]: [Не определено]

### Блокеры и риски
1. [Блокер]: [Анализ влияния]
2. [Риск]: [Предложения по реагированию]
```

### 7. Генерация рекомендаций по улучшению

Предоставление конкретных рекомендаций на основе результатов анализа:

```markdown
## Рекомендации по улучшению

### Срочные исправления (P0)
1. **[Проблема]**
   - Влияние: [Описание влияния]
   - Рекомендация: [Конкретный план исправления]
   - Местоположение: [Конкретная глава/абзац]

### Рекомендации по оптимизации (P1)
1. **[Оптимизируемый элемент]**
   - Текущее состояние: [Текущее состояние]
   - Рекомендация: [План оптимизации]
   - Ожидаемый результат: [Результат улучшения]

### Долгосрочные улучшения (P2)
1. **[Направление улучшения]**
   - Обоснование: [Почему необходимо]
   - План: [Как реализовать]
   - Сроки: [Когда реализовать]
```

### 8. Генерация отчёта о проверке

Создание файла `stories/*/analysis-report.md`:

```markdown
# Отчёт об анализе произведения

## Резюме
- Дата анализа: [YYYY-MM-DD]
- Версия произведения: [Версия произведения]
- Общая оценка: [X/10]
- Рекомендуемые действия: [Продолжить/Пересмотреть/Переписать]

## Ключевые метрики
| Аспект | Оценка | Описание |
|--------|--------|----------|
| Соответствие конституции | X/10 | [Описание] |
| Соответствие спецификациям | X/10 | [Описание] |
| Выполнение плана | X/10 | [Описание] |
| Качество контента | X/10 | [Описание] |
| Восприятие читателем | X/10 | [Прогноз] |

## Ключевые выводы
[3-5 наиболее важных выводов]

## Следующие шаги
[Конкретные рекомендации по действиям на основе анализа]
```

### 9. Интерактивное улучшение

Предоставление интерактивных опций:
- Просмотр деталей конкретной проблемы
- Создание задач для исправления
- Обновление плана
- Корректировка спецификаций

### 10. Постоянный мониторинг

Настройка механизма контроля качества:
- Автоматический анализ каждые 5 завершённых глав
- Принудительный анализ на ключевых этапах
- Отслеживание тенденций качества

## Структура анализируемых аспектов

### Семь аспектов анализа
1. **Соответствие** (Compliance): Соответствие конституции и спецификациям
2. **Согласованность** (Consistency): Логика, персонажи, мир
3. **Полнота** (Completeness): Охват требований, выполнение задач
4. **Качество** (Quality): Текст, структура, темп
5. **Инновационность** (Innovation): Сильные стороны, особенности, прорывы
6. **Читабельность** (Readability): Плавность, увлекательность, резонанс
7. **Осуществимость** (Feasibility): Прогресс, ресурсы, риски

## Критерии оценки

```
10 баллов: Идеально, превосходит ожидания
8-9 баллов: Отлично, незначительные недостатки
6-7 баллов: Хорошо, требуется оптимизация
4-5 баллов: Удовлетворительно, много проблем
1-3 балла: Плохо, требуется переписывание
```

## Связь с другими командами

- **Входные данные**: Все предыдущие документы + фактическое содержание
- **Выходные данные**: Отчёт об анализе + рекомендации по улучшению
- **Триггеры**: Может инициировать обновление задач, корректировку планов

## Примечания

### Объективный анализ
- Основываться на данных и стандартах
- Избегать субъективных суждений
- Предоставлять конкретные доказательства

### Конструктивная обратная связь
- Чётко определять проблемы
- Предлагать выполнимые решения
- Сохранять позитивный настрой

### Постоянное совершенствование
- Анализ проводится для улучшения
- Регистрировать результаты каждого анализа
- Отслеживать эффект от улучшений

Помните: **Цель анализа — сделать произведение лучше, а не критиковать.**