```markdown
## Краткий контекст для ИИ-агентов по написанию кода

Этот репозиторий представляет собой CLI-инструмент и набор шаблонов с фокусом на ИИ для создания китайских романов с использованием рабочего процесса Spec-Driven Development (SDD). Ключевые компоненты:

- `src/cli.ts` — основной CLI-вход (команды: `init`, `upgrade` и т. д.). Посмотрите здесь, как инициализируются проекты и как типы ИИ-агентов соотносятся с файловой структурой.
- `package.json` — скрипты сборки/разработки. `npm run build` компилирует TypeScript; `npm run build:commands` генерирует файлы команд для каждого агента из шаблонов.
- `dist/*` — артефакты сборки, содержащие предварительно сгенерированные наборы команд агентов (копируются в проекты пользователей с помощью `init`).
- `.specify/`, `spec/`, `stories/` — структура проекта во время выполнения, создаваемая `novel init`.
- `other/spec-kit/AGENTS.md` — подробное руководство и соглашения для агентов; используйте его как авторитетный источник при добавлении новых агентов.

Сохраняйте инструкции короткими и конкретными: ссылайтесь на точный файл и функцию, которые вы изменили, и предпочитайте небольшие, самодостаточные правки.

## Заметки по высокоуровневой архитектуре

- CLI инициализирует проект, копируя собранные артефакты из корневого каталога пакета (`dist/<agent>`) в целевой проект и создавая структуру `.specify/*` (логика копирования в `src/cli.ts` вокруг `sourceMap`).
- Конфигурация агента является центрированной: создаются и заполняются такие каталоги, как `.claude/commands`, `.gemini/commands`, `.cursor/commands` во время `novel init`.
- Метаданные агента и решения о его поведении сосредоточены в шаблонах Spec Kit, описанных в `other/spec-kit/AGENTS.md`. При добавлении агентов отдавайте предпочтение обновлению `AGENT_CONFIG` (в реализации spec-kit) и инструментам обновления `scripts/*`.

## Распространенные рабочие процессы разработчика (как запускать / собирать / тестировать)

- Локальная разработка: `npm run dev` (запускает `tsx src/cli.ts`) — быстрый способ итерации поведения CLI без сборки.
- Сборка: `npm run build` (TypeScript -> `dist/`), затем `npm run build:commands` для регенерации файлов команд для каждого агента. `prepare` и `prepublishOnly` вызывают обе команды.
- Если действие `init` выдает предупреждение об отсутствии артефакта `dist`, выполните `npm run build:commands` и повторно выполните команду.

Файлы для проверки при изменении команд или шаблонов агентов:
- `scripts/build/generate-commands.sh` — генератор, используемый `npm run build:commands`.
- `templates/` и `dist/<agent>/` — места, где находятся сгенерированные шаблоны и файлы команд.

## Соглашения и особенности, специфичные для проекта (не изобретайте)

- Используйте фактическое имя исполняемого файла CLI в качестве ключа агента (например, `cursor-agent`, а не `cursor`). Это обеспечивается во всех скриптах и логике проверки инструментов (`other/spec-kit/AGENTS.md`).
- Форматы команд различаются для каждого агента:
  - Markdown-промпты (Claude, Cursor, opencode): плейсхолдеры `$ARGUMENTS`, `{SCRIPT}`.
  - TOML-промпты (Gemini, Qwen): плейсхолдеры `{{args}}` и ключи `prompt`.
  См. `other/spec-kit/AGENTS.md` для точных примеров и вспомогательных функций `generateMarkdownCommand` / `generateTomlCommand` в `src/cli.ts`.
- При добавлении файлов в `dist/` для агента обновите `scripts/*/update-agent-context.(sh|ps1)` и `.github/workflows/scripts/create-release-packages.sh`, чтобы включить случай упаковки агента.

## Что менять при добавлении или обновлении агента

1. Обновите метаданные агента в едином источнике истины (AGENT_CONFIG в реализации spec-kit).
2. Обновите справочный текст `src/cli.ts` (опция `--ai`) и любой `switch`, который создает каталоги ИИ.
3. Добавьте поддержку генерации в `scripts/build/generate-commands.sh` (и скрипты упаковки релизов).
4. Добавьте или обновите шаблоны в `templates/` и запустите `npm run build:commands`.
5. Обновите `other/spec-kit/scripts/*` (bash + PowerShell), которые собирают файлы контекста агента для документации README/CLAUDE/Copilot.

## Примеры (явные ссылки)

- Для регенерации команд после редактирования шаблона: выполните `npm run build:commands`. Если CLI `init` не может найти `dist/<agent>`, это обычно является решением.
- Если вы измените способ ссылки на агента, найдите в `src/cli.ts` `sourceMap` и ветку `switch(options.ai)`, которая сопоставляет значения `--ai` с каталогами.
- При добавлении обнаружения или проверки CLI для нового агента следуйте шаблону `requires_cli`, описанному в `other/spec-kit/AGENTS.md`, и обновите скрипты `scripts/bash/update-agent-context.sh` и `scripts/powershell/update-agent-context.ps1`.

## Безопасность и стиль

- Предпочтительны небольшие, сфокусированные исправления. При редактировании шаблонов сохраняйте фронтматер и плейсхолдеры `{SCRIPT}`, используемые генераторами.
- Предпочитайте модификацию `templates/` и запуск генератора вместо ручного редактирования файлов `dist/`.

## Краткая карта файлов (начните здесь)

- `src/cli.ts` — поведение CLI и инициализация проекта
- `src/ai-interface.ts` — API для ИИ и логика выбора методов
- `scripts/build/generate-commands.sh` — генератор команд, используемый в CI и локальных сборках
- `other/spec-kit/AGENTS.md` — соглашения для агентов и шаги интеграции (авторитетный источник)
- `package.json` — скрипты сборки/разработки (`dev`, `build`, `build:commands`, `prepare`)

Если что-либо в этой странице инструкций неясно или вы хотите получить больше примеров (например, образец команды TOML, преобразованной из команды Markdown в этой кодовой базе), сообщите мне, какую область расширить, и я буду итерировать.
```