---
filename: PRD-external-suggestion-integration.md
source-format: md
source-language: auto
target-language: ru-RU
line-fist: 1
line-last: 360
total-lines: 360
---

# PRD: Интеграция внешних ИИ-рекомендаций

> Документ с требованиями к продукту

## 1. Обзор

### 1.1 Контекст
После того как пользователи написали 10 глав в Novel Writer, они хотят получать рекомендации от других ИИ-инструментов (таких как Gemini, ChatGPT и т. д.) и изящно интегрировать эти рекомендации в существующие творческие спецификации (spec) для постоянного улучшения качества произведения.

### 1.2 Цели
- Предоставить стандартизированный механизм интеграции внешних рекомендаций.
- Поддерживать простоту системы, не добавляя ненужных команд.
- Реализовать отслеживаемость и управление версиями рекомендаций.
- Обеспечить стандартизацию и возможность парсинга формата рекомендаций.

### 1.3 Ценностное предложение
- **Повышение качества произведения**: Сотрудничество нескольких ИИ для использования сильных сторон каждого.
- **Поддержание связности творчества**: Автоматическая интеграция рекомендаций в спецификации.
- **Повышение эффективности**: Стандартизированный процесс, сокращение ручных операций.

## 2. Дизайн функций

### 2.1 Основная функция
Расширение существующей команды `/constitution` добавлением подкоманды `refine`:
```
/constitution refine [содержание рекомендации]
```

### 2.2 Процесс функции
```mermaid
graph LR
    A[Автор завершает N глав] --> B[Анализ с помощью внешнего ИИ]
    B --> C[Получение структурированных рекомендаций]
    C --> D[Копирование рекомендаций в Claude Code]
    D --> E[Выполнение /constitution refine]
    E --> F[Парсинг рекомендаций системой]
    F --> G[Интеллектуальное слияние в spec]
    G --> H[Генерация отчета об улучшениях]
    H --> I[Продолжение написания]
```

### 2.3 Обработка категорий рекомендаций

| Тип рекомендации | Целевой файл | Способ обработки |
|---------|---------|----------|
| Стиль письма | `.specify/memory/writing-constitution.md` | Слияние в соответствующую главу |
| Оптимизация персонажа | `spec/knowledge/character-profiles.md` | Обновление профиля персонажа |
| Рекомендации по сюжету | `spec/tracking/plot-tracker.json` | Добавление нового узла |
| Дополнение мировоззрения | `spec/knowledge/world-setting.md` | Расширение сеттинга |
| Корректировка темпа | `.specify/memory/writing-constitution.md` | Обновление стандарта качества |

## 3. Спецификация вывода сторонних ИИ

### 3.1 Стандартный формат рекомендаций
Сторонние ИИ должны выводить рекомендации в следующем формате JSON:

```json
{
  "version": "1.0",
  "source": "Gemini Pro",
  "analysis_date": "2025-01-24",
  "chapters_analyzed": {
    "start": 1,
    "end": 10,
    "total_words": 42000
  },
  "suggestions": {
    "style": {
      "priority": "high",
      "items": [
        {
          "type": "narrative_voice",
          "current": "Третье лицо, всезнающий взгляд, присутствуют скачки",
          "suggestion": "Сохранять единую точку зрения, рекомендуется зафиксировать на точке зрения главного героя",
          "examples": ["Глава 3, абзац 2", "Начало главы 7"],
          "impact": "Повышение связности повествования"
        },
        {
          "type": "pacing",
          "current": "Темп в главах 5-7 слишком напряженный",
          "suggestion": "Добавить переходные абзацы для передышки читателя",
          "examples": ["Прямой переход к следующему конфликту после боя в главе 6"],
          "impact": "Улучшение читательского опыта"
        }
      ]
    },
    "characters": {
      "priority": "medium",
      "items": [
        {
          "character": "Главная героиня",
          "issue": "Слишком быстрая смена характера",
          "suggestion": "Добавить психологическое описание между 4 и 8 главами",
          "development_curve": "Постепенный рост",
          "chapters_affected": [4, 5, 6, 7, 8]
        }
      ]
    },
    "plot": {
      "priority": "low",
      "items": [
        {
          "type": "foreshadowing",
          "location": "Завязка, сделанная в главе 3",
          "status": "Не разрешено",
          "suggestion": "Рекомендуется разрешить до главы 15",
          "importance": "medium"
        }
      ]
    },
    "worldbuilding": {
      "priority": "medium",
      "items": [
        {
          "aspect": "Магическая система",
          "issue": "Правила недостаточно ясны",
          "suggestion": "Добавить источник энергии и ограничения",
          "reference_chapters": [2, 5, 9]
        }
      ]
    },
    "dialogue": {
      "priority": "high",
      "items": [
        {
          "character": "Главный герой",
          "issue": "Слишком современная лексика",
          "suggestion": "Изменить на лексику, соответствующую древнему сеттингу",
          "examples": ["OK", "Нет проблем", "Готово"],
          "alternatives": ["Хорошо", "Не беда", "Сделано"]
        }
      ]
    }
  },
  "overall_rating": {
    "plot_coherence": 8,
    "character_development": 7,
    "world_building": 6,
    "writing_style": 7,
    "reader_engagement": 8
  },
  "key_improvements": [
    "Унифицировать точку зрения повествования",
    "Усилить психологическое описание персонажей",
    "Улучшить сеттинг мира"
  ]
}
```

### 3.2 Шаблон подсказки (для сторонних ИИ)

```markdown
# Задача анализа написания романа

Проанализируйте предоставленные мной первые 10 глав романа и выведите рекомендации в следующем формате JSON.

## Требования к выводу
1. Обязательно используйте строгий формат JSON.
2. Все рекомендации должны быть конкретизированы по главам.
3. Предоставьте действенные предложения по улучшению.
4. Укажите приоритет (high/medium/low).

## Описание структуры JSON
- version: Фиксированное значение "1.0".
- source: Название вашего ИИ.
- analysis_date: Формат YYYY-MM-DD.
- chapters_analyzed: Диапазон анализируемых глав.
- suggestions: Категоризированные рекомендации.
  - style: Рекомендации по стилю письма.
  - characters: Рекомендации по развитию персонажей.
  - plot: Рекомендации по развитию сюжета.
  - worldbuilding: Рекомендации по мировоззрению.
  - dialogue: Рекомендации по улучшению диалогов.
- overall_rating: Оценка по каждому аспекту (1-10).
- key_improvements: 3 наиболее важных пункта для улучшения.

## Пример вывода
[Вставьте сюда пример JSON]

Пожалуйста, выводите строго в соответствии с этим форматом, чтобы программа могла его разобрать.
```

### 3.3 Упрощенный формат (версия Markdown)
Если пользователь не может получить формат JSON, можно использовать структурированный Markdown:

```markdown
# Отчет о рекомендациях по написанию романа

## Базовая информация
- Инструмент анализа: Gemini Pro
- Дата анализа: 2025-01-24
- Диапазон анализа: Главы 1-10, всего 42000 слов

## Рекомендации по стилю письма [Высокий приоритет]

### Точка зрения повествования
- **Проблема**: Третье лицо, всезнающий взгляд, присутствуют скачки.
- **Рекомендация**: Сохранять единую точку зрения, зафиксировать на точке зрения главного героя.
- **Пример**: Абзац 2 главы 3, начало главы 7.
- **Ожидаемый результат**: Повышение связности повествования.

### Контроль темпа
- **Проблема**: Темп в главах 5-7 слишком напряженный.
- **Рекомендация**: Добавить переходные абзацы.
- **Пример**: Прямой переход к следующему конфликту после боя в главе 6.
- **Ожидаемый результат**: Улучшение читательского опыта.

## Рекомендации по оптимизации персонажей [Средний приоритет]

### Главная героиня
- **Проблема**: Слишком быстрая смена характера.
- **Рекомендация**: Добавить психологическое описание между 4 и 8 главами.
- **Кривая развития**: Постепенный рост.
- **Затронутые главы**: 4, 5, 6, 7, 8.

## Рекомендации по развитию сюжета [Низкий приоритет]

### Управление завязками
- **Место**: Завязка, сделанная в главе 3.
- **Статус**: Не разрешено.
- **Рекомендация**: Разрешить до главы 15.
- **Важность**: Средняя.

## Рекомендации по мировоззрению [Средний приоритет]

### Магическая система
- **Проблема**: Правила недостаточно ясны.
- **Рекомендация**: Добавить источник энергии и ограничения.
- **Справочные главы**: 2, 5, 9.

## Рекомендации по оптимизации диалогов [Высокий приоритет]

### Лексика главного героя
- **Проблема**: Слишком современная.
- **Требуется замена**: OK → Хорошо, Нет проблем → Не беда, Готово → Сделано.
- **Принцип**: Соответствие древнему сеттингу.

## Общая оценка
- Связность сюжета: 8/10
- Развитие персонажей: 7/10
- Построение мира: 6/10
- Стиль письма: 7/10
- Вовлеченность читателя: 8/10

## Три ключевых улучшения
1. Унифицировать точку зрения повествования.
2. Усилить психологическое описание персонажей.
3. Улучшить сеттинг мира.
```

## 4. Техническая реализация

### 4.1 Расширение команды
Изменить `templates/commands/constitution.md`:
```yaml
---
description: Установка и оптимизация стиля написания романа
scripts:
  sh: .specify/scripts/bash/constitution-manager.sh
---

Использование:
1. /constitution - Инициализация стиля написания
2. /constitution refine [Рекомендация] - Интеграция внешних рекомендаций
```

### 4.2 Парсер рекомендаций
Создать `.specify/scripts/bash/parse-suggestions.sh`:
```bash
#!/bin/bash
# Парсинг рекомендаций в формате JSON или Markdown
# Автоматическое определение формата
# Извлечение ключевой информации
# Генерация инструкций по обновлению
```

### 4.3 Хранение данных
Добавить файлы:
- `spec/knowledge/improvement-log.md` - История рекомендаций
- `spec/knowledge/suggestion-templates/` - Библиотека шаблонов рекомендаций
- `.specify/memory/refinement-history.json` - История улучшений

## 5. Пользовательский опыт

### 5.1 Процесс использования
1. **Получение рекомендаций**
   ```
   Пользователь: Проанализируй мои первые 10 глав романа и дай рекомендации по улучшению.
   Gemini: [Возврат структурированных рекомендаций]
   ```

2. **Копирование рекомендаций**
   Скопировать полный вывод Gemini.

3. **Выполнение интеграции**
   ```
   /constitution refine """
   [Вставить содержание рекомендаций]
   """
   ```

4. **Просмотр отчета**
   ```
   ✅ Интеграция рекомендаций завершена
   - Обновлено правил письма: 3
   - Оптимизировано профилей персонажей: 2
   - Дополнено мировоззрение: 1
   Подробнее см.: spec/knowledge/improvement-log.md
   ```

### 5.2 Обработка ошибок
- Ошибка формата: Предоставить подсказки по исправлению формата.
- Конфликтующие рекомендации: Отметить для ручного подтверждения.
- Повторяющиеся рекомендации: Автоматическое удаление дубликатов.

## 6. Критерии успеха

### 6.1 Функциональные метрики
- Успешность парсинга рекомендаций > 95%
- Точность автоматической интеграции > 90%
- Время обработки < 3 секунд

### 6.2 Пользовательские метрики
- Коэффициент принятия рекомендаций > 70%
- Повышение качества произведения (на основе последующих отзывов)
- Удовлетворенность пользователей > 8/10

## 7. Будущее расширение

### 7.1 Фаза 2
- Сравнение рекомендаций от нескольких ИИ.
- Автоматический расчет веса рекомендаций.
- A/B тестирование эффективности различных рекомендаций.

### 7.2 Фаза 3
- Отслеживание эффективности рекомендаций.
- Оптимизация принятия рекомендаций с помощью машинного обучения.
- Персонализированные фильтры рекомендаций.

## 8. Риски и меры противодействия

| Риск | Влияние | Меры противодействия |
|-----|------|-----|
| Неравномерное качество рекомендаций | Влияние на творчество | Предоставить механизм оценки рекомендаций |
| Несогласованность форматов | Ошибка парсинга | Обеспечить совместимость с несколькими форматами + обработка ошибок |
| Чрезмерная зависимость от внешних рекомендаций | Потеря индивидуального стиля | Контроль степени принятия рекомендаций |

## 9. Приложения

### 9.1 Связанные документы
- [Руководство по методам письма](../spec/knowledge/writing-methods-guide.md)
- [Описание системы команд](./command-system.md)
- [Документация по системе отслеживания](./tracking-system.md)

### 9.2 История версий
- v1.0 (2025-01-24): Начальная версия

---
*Статус документа: Черновик*
*Автор: Команда Novel Writer*
*Последнее обновление: 2025-01-24*