#!/usr/bin/env bash
# ะกะบัะธะฟั ะฟัะพะฒะตัะบะธ ัะพะณะปะฐัะพะฒะฐะฝะฝะพััะธ ะผะธัะพะฒะพะทะทัะตะฝะธั

set -e

# ะะฐะณััะทะบะฐ ะพะฑัะธั ััะฝะบัะธะน
SCRIPT_DIR=$(dirname "$0")
source "$SCRIPT_DIR/common.sh"

# ะะพะปััะตะฝะธะต ัะตะบััะตะน ะดะธัะตะบัะพัะธะธ ะธััะพัะธะธ
STORY_DIR=$(get_current_story)

if [ -z "$STORY_DIR" ]; then
    echo "ะัะธะฑะบะฐ: ะัะพะตะบั ะธััะพัะธะธ ะฝะต ะฝะฐะนะดะตะฝ" >&2
    exit 1
fi

# ะะตะถะธะผ ะฟัะพะฒะตัะบะธ
CHECKLIST_MODE=false
if [ "$1" = "--checklist" ]; then
    CHECKLIST_MODE=true
fi

# ะััะธ ะบ ัะฐะนะปะฐะผ
WORLD_SETTING="$STORY_DIR/spec/knowledge/world-setting.md"
LOCATIONS="$STORY_DIR/spec/knowledge/locations.md"
CULTURE="$STORY_DIR/spec/knowledge/culture.md"
RULES="$STORY_DIR/spec/knowledge/rules.md"
CONTENT_DIR="$STORY_DIR/content"

# ะะพะดั ัะฒะตัะพะฒ ANSI
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# ะะตัะตะผะตะฝะฝัะต ะดะปั ััะฐัะธััะธะบะธ
TOTAL_CHECKS=0
PASSED_CHECKS=0
WARNINGS=0
ERRORS=0
ISSUES=()

# ะคัะฝะบัะธั ะฟัะพะฒะตัะบะธ
check() {
    local name="$1"
    local condition="$2"
    local error_msg="$3"

    ((TOTAL_CHECKS++))

    if eval "$condition"; then
        if [ "$CHECKLIST_MODE" = false ]; then
            echo -e "${GREEN}โ${NC} $name"
        fi
        ((PASSED_CHECKS++))
    else
        if [ "$CHECKLIST_MODE" = false ]; then
            echo -e "${RED}โ${NC} $name: $error_msg"
        fi
        ((ERRORS++))
        ISSUES+=("$name|$error_msg")
    fi
}

warn() {
    local msg="$1"
    if [ "$CHECKLIST_MODE" = false ]; then
        echo -e "${YELLOW}โ${NC} ะัะตะดัะฟัะตะถะดะตะฝะธะต: $msg"
    fi
    ((WARNINGS++))
    ISSUES+=("ะัะตะดัะฟัะตะถะดะตะฝะธะต|$msg")
}

# ะัะพะฒะตัะบะฐ ัะตะปะพััะฝะพััะธ ัะฐะนะปะพะฒ ะฝะฐัััะพะตะบ
check_setting_files() {
    if [ "$CHECKLIST_MODE" = false ]; then
        echo "๐ ะัะพะฒะตัะบะฐ ัะตะปะพััะฝะพััะธ ัะฐะนะปะพะฒ ะฝะฐัััะพะตะบ"
        echo "โโโโโโโโโโโโโโโโโโโโโ"
    fi

    check "world-setting.md" "[ -f '$WORLD_SETTING' ]" "ะััััััะฒัะตั ะพัะฝะพะฒะฝะพะน ัะฐะนะป ะผะธัะพะฒะพะทะทัะตะฝะธั"
    check "locations.md" "[ -f '$LOCATIONS' ]" "ะััััััะฒัะตั ัะฐะนะป ะพะฟะธัะฐะฝะธั ะปะพะบะฐัะธะน"
    check "culture.md" "[ -f '$CULTURE' ]" "ะััััััะฒัะตั ัะฐะนะป ะพะฟะธัะฐะฝะธั ะบัะปััััั ะธ ะพะฑััะฐะตะฒ"
    check "rules.md" "[ -f '$RULES' ]" "ะััััััะฒัะตั ัะฐะนะป ัะฟะตัะธะฐะปัะฝัั ะฟัะฐะฒะธะป"

    if [ "$CHECKLIST_MODE" = false ]; then
        echo ""
    fi
}

# ะัะพะฒะตัะบะฐ ัะพะณะปะฐัะพะฒะฐะฝะฝะพััะธ ัะตัะผะธะฝะพะปะพะณะธะธ
check_terminology() {
    if [ "$CHECKLIST_MODE" = false ]; then
        echo "๐ ะัะพะฒะตัะบะฐ ัะพะณะปะฐัะพะฒะฐะฝะฝะพััะธ ัะตัะผะธะฝะพะปะพะณะธะธ"
        echo "โโโโโโโโโโโโโโโโ"
    fi

    if [ -d "$CONTENT_DIR" ]; then
        # ะะทะฒะปะตัะตะฝะธะต ะธะผะตะฝ ัะพะฑััะฒะตะฝะฝัั ะธะท ะดะพะบัะผะตะฝัะฐัะธะธ ะผะธัะพะฒะพะทะทัะตะฝะธั (ัะฟัะพัะตะฝะฝะฐั ะฒะตััะธั, ะฒ ัะตะฐะปัะฝะพััะธ ัะปะพะถะฝะตะต)
        local term_count=0

        if [ -f "$WORLD_SETTING" ]; then
            # ะะพะดััะตั ะธะผะตะฝ ัะพะฑััะฒะตะฝะฝัั (ะทะดะตัั ัะฟัะพัะตะฝะฝะพ ััะธัะฐะตะผ ัะปะพะฒะฐ, ะฒัะดะตะปะตะฝะฝัะต ะถะธัะฝัะผ ะธะปะธ ัะฟะตัะธะฐะปัะฝัะผะธ ะผะฐัะบะตัะฐะผะธ)
            term_count=$(grep -o '\*\*[^*]*\*\*' "$WORLD_SETTING" 2>/dev/null | wc -l || echo 0)
        fi

        check "ะะฟัะตะดะตะปะตะฝะธะต ะธะผะตะฝ ัะพะฑััะฒะตะฝะฝัั" "[ $term_count -gt 0 ]" "ะะต ะฝะฐะนะดะตะฝะพ ะพะฟัะตะดะตะปะตะฝะธะน ะธะผะตะฝ ัะพะฑััะฒะตะฝะฝัั"

        if [ "$CHECKLIST_MODE" = false ]; then
            echo "  ๐ ะะพะปะธัะตััะฒะพ ะธะผะตะฝ ัะพะฑััะฒะตะฝะฝัั: $term_count"
        fi
    else
        warn "ะะธัะตะบัะพัะธั ะบะพะฝัะตะฝัะฐ ะพััััััะฒัะตั, ะฟัะพะฟััะบ ะฟัะพะฒะตัะบะธ ัะตัะผะธะฝะพะปะพะณะธะธ"
    fi

    if [ "$CHECKLIST_MODE" = false ]; then
        echo ""
    fi
}

# ะัะพะฒะตัะบะฐ ะณะตะพะณัะฐัะธัะตัะบะพะน ะปะพะณะธะบะธ
check_geography() {
    if [ "$CHECKLIST_MODE" = false ]; then
        echo "๐บ๏ธ  ะัะพะฒะตัะบะฐ ะณะตะพะณัะฐัะธัะตัะบะพะน ะปะพะณะธะบะธ"
        echo "โโโโโโโโโโโโโโโ"
    fi

    if [ -f "$LOCATIONS" ]; then
        # ะะพะดััะตั ะพะฟัะตะดะตะปะตะฝะฝัั ะปะพะบะฐัะธะน
        local location_count=$(grep -c '^##' "$LOCATIONS" 2>/dev/null || echo 0)

        check "ะะพะปะฝะพัะฐ ะพะฟัะตะดะตะปะตะฝะธั ะปะพะบะฐัะธะน" "[ $location_count -gt 0 ]" "ะะต ะพะฟัะตะดะตะปะตะฝะพ ะฝะธ ะพะดะฝะพะน ะปะพะบะฐัะธะธ"

        if [ "$CHECKLIST_MODE" = false ]; then
            echo "  ๐ ะะฟัะตะดะตะปะตะฝะพ ะปะพะบะฐัะธะน: ${location_count} ัั."
        fi

        # ะัะพะฒะตัะบะฐ ัะฟะพะผะธะฝะฐะตะผัั ะฒ ะบะพะฝัะตะฝัะต ะปะพะบะฐัะธะน ะฝะฐ ะฝะฐะปะธัะธะต ะฒ ะพะฟัะตะดะตะปะตะฝะธัั
        if [ -d "$CONTENT_DIR" ]; then
            # ะะดะตัั ัะฟัะพัะตะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ, ะฒ ัะตะฐะปัะฝะพััะธ ััะตะฑัะตััั ะฑะพะปะตะต ัะปะพะถะฝะฐั ะปะพะณะธะบะฐ ัะพะฟะพััะฐะฒะปะตะฝะธั
            local undefined_locations=0

            # TODO: ะะตะฐะปะธะทะพะฒะฐัั ะฑะพะปะตะต ะธะฝัะตะปะปะตะบััะฐะปัะฝัั ะปะพะณะธะบั ัะพะฟะพััะฐะฒะปะตะฝะธั ะปะพะบะฐัะธะน
            # ะะพะบะฐ ัะพะปัะบะพ ะฑะฐะทะพะฒะฐั ะฟัะพะฒะตัะบะฐ ัะฐะนะปะพะฒ

            check "ะัะพะฒะตัะบะฐ ัััะปะพะบ ะฝะฐ ะปะพะบะฐัะธะธ" "[ $undefined_locations -eq 0 ]" "ะะฑะฝะฐััะถะตะฝั ัััะปะบะธ ะฝะฐ ะฝะตะพะฟัะตะดะตะปะตะฝะฝัะต ะปะพะบะฐัะธะธ"
        fi
    else
        warn "ะััััััะฒัะตั ัะฐะนะป ะพะฟะธัะฐะฝะธั ะปะพะบะฐัะธะน"
    fi

    if [ "$CHECKLIST_MODE" = false ]; then
        echo ""
    fi
}

# ะัะพะฒะตัะบะฐ ะบัะปััััะฝะพะน ัะพะณะปะฐัะพะฒะฐะฝะฝะพััะธ
check_culture() {
    if [ "$CHECKLIST_MODE" = false ]; then
        echo "๐ญ ะัะพะฒะตัะบะฐ ะบัะปััััะฝะพะน ัะพะณะปะฐัะพะฒะฐะฝะฝะพััะธ"
        echo "โโโโโโโโโโโโโโโโ"
    fi

    if [ -f "$CULTURE" ]; then
        # ะะพะดััะตั ะบัะปััััะฝัั ัะปะตะผะตะฝัะพะฒ
        local culture_count=$(grep -c '^##' "$CULTURE" 2>/dev/null || echo 0)

        check "ะะฟัะตะดะตะปะตะฝะธะต ะบัะปััััะฝัั ัะปะตะผะตะฝัะพะฒ" "[ $culture_count -gt 0 ]" "ะะต ะพะฟัะตะดะตะปะตะฝะพ ะฝะธ ะพะดะฝะพะณะพ ะบัะปััััะฝะพะณะพ ัะปะตะผะตะฝัะฐ"

        if [ "$CHECKLIST_MODE" = false ]; then
            echo "  ๐ ะัะปััััะฝัั ัะปะตะผะตะฝัะพะฒ: ${culture_count} ัั."
        fi
    else
        warn "ะััััััะฒัะตั ัะฐะนะป ะพะฟะธัะฐะฝะธั ะบัะปััััั ะธ ะพะฑััะฐะตะฒ"
    fi

    if [ "$CHECKLIST_MODE" = false ]; then
        echo ""
    fi
}

# ะัะพะฒะตัะบะฐ ัะพะณะปะฐัะพะฒะฐะฝะฝะพััะธ ะฟัะฐะฒะธะป
check_rules() {
    if [ "$CHECKLIST_MODE" = false ]; then
        echo "โ๏ธ  ะัะพะฒะตัะบะฐ ัะพะณะปะฐัะพะฒะฐะฝะฝะพััะธ ะฟัะฐะฒะธะป"
        echo "โโโโโโโโโโโโโโโ"
    fi

    if [ -f "$RULES" ]; then
        # ะะพะดััะตั ัะฟะตัะธะฐะปัะฝัั ะฟัะฐะฒะธะป
        local rule_count=$(grep -c '^##' "$RULES" 2>/dev/null || echo 0)

        check "ะะฟัะตะดะตะปะตะฝะธะต ัะฟะตัะธะฐะปัะฝัั ะฟัะฐะฒะธะป" "[ $rule_count -gt 0 ]" "ะะต ะพะฟัะตะดะตะปะตะฝะพ ะฝะธ ะพะดะฝะพะณะพ ัะฟะตัะธะฐะปัะฝะพะณะพ ะฟัะฐะฒะธะปะฐ"

        if [ "$CHECKLIST_MODE" = false ]; then
            echo "  ๐ ะกะฟะตัะธะฐะปัะฝัั ะฟัะฐะฒะธะป: ${rule_count} ัั."
        fi
    else
        warn "ะััััััะฒัะตั ัะฐะนะป ัะฟะตัะธะฐะปัะฝัั ะฟัะฐะฒะธะป"
    fi

    if [ "$CHECKLIST_MODE" = false ]; then
        echo ""
    fi
}

# ะะตะฝะตัะฐัะธั ะพะฑััะฝะพะณะพ ะพััะตัะฐ
generate_report() {
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "๐ ะััะตั ะพ ะฟัะพะฒะตัะบะต ัะพะณะปะฐัะพะฒะฐะฝะฝะพััะธ ะผะธัะพะฒะพะทะทัะตะฝะธั"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""

    check_setting_files
    check_terminology
    check_geography
    check_culture
    check_rules

    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "๐ ะกะฒะพะดะบะฐ ัะตะทัะปััะฐัะพะฒ ะฟัะพะฒะตัะบะธ"
    echo "โโโโโโโโโโโโโโโโโโโ"
    echo "  ะัะตะณะพ ะฟัะพะฒะตัะพะบ: ${TOTAL_CHECKS}"
    echo -e "  ${GREEN}ะัะพะนะดะตะฝะพ: ${PASSED_CHECKS}${NC}"
    echo -e "  ${YELLOW}ะัะตะดัะฟัะตะถะดะตะฝะธะน: ${WARNINGS}${NC}"
    echo -e "  ${RED}ะัะธะฑะพะบ: ${ERRORS}${NC}"

    if [ "$ERRORS" -eq 0 ] && [ "$WARNINGS" -eq 0 ]; then
        echo ""
        echo -e "${GREEN}โ ะัะปะธัะฝะพ! ะัะต ะฟัะพะฒะตัะบะธ ะฟัะพะนะดะตะฝั${NC}"
    elif [ "$ERRORS" -eq 0 ]; then
        echo ""
        echo -e "${YELLOW}โ๏ธ  ะะฑะฝะฐััะถะตะฝะพ ${WARNINGS} ะฟัะตะดัะฟัะตะถะดะตะฝะธะน, ัะตะบะพะผะตะฝะดัะตััั ะพะฑัะฐัะธัั ะฒะฝะธะผะฐะฝะธะต${NC}"
    else
        echo ""
        echo -e "${RED}โ ะะฑะฝะฐััะถะตะฝะพ ${ERRORS} ะพัะธะฑะพะบ, ััะตะฑัะตััั ะธัะฟัะฐะฒะปะตะฝะธะต${NC}"
    fi

    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "ะัะตะผั ะฟัะพะฒะตัะบะธ: $(date '+%Y-%m-%d %H:%M:%S')"
    echo ""
    echo "๐ก ะะตะบะพะผะตะฝะดะฐัะธะธ:"
    echo "  - ะะตะณัะปััะฝะพ ะพะฑะฝะพะฒะปัะนัะต ะดะพะบัะผะตะฝัั ั ะฝะฐัััะพะนะบะฐะผะธ ะผะธัะพะฒะพะทะทัะตะฝะธั"
    echo "  - ะกะพะทะดะฐะนัะต ะณะปะพััะฐัะธะน ะดะปั ะฟะพะดะดะตัะถะฐะฝะธั ะตะดะธะฝะพะพะฑัะฐะทะธั ัะตัะผะธะฝะพะปะพะณะธะธ"
    echo "  - ะะฐะฟะธััะฒะฐะนัะต ะพัะฝะพัะตะฝะธั ัะฐัััะพัะฝะธะน ะธ ะฝะฐะฟัะฐะฒะปะตะฝะธะน ะผะตะถะดั ะปะพะบะฐัะธัะผะธ"
}

# ะะตะฝะตัะฐัะธั ะฒัะฒะพะดะฐ ะฒ ัะพัะผะฐัะต checklist
output_checklist() {
    # ะะพะฒัะพัะฝะพะต ะฒัะฟะพะปะฝะตะฝะธะต ะปะพะณะธะบะธ ะฟัะพะฒะตัะบะธ ะดะปั ัะฑะพัะฐ ะดะฐะฝะฝัั
    TOTAL_CHECKS=0
    PASSED_CHECKS=0
    ERRORS=0
    WARNINGS=0
    ISSUES=()

    check_setting_files
    check_terminology
    check_geography
    check_culture
    check_rules

    # ะัะฒะพะด ะฒ ัะพัะผะฐัะต checklist
    cat <<EOF
# ะงะตะบ-ะปะธัั ะฟัะพะฒะตัะบะธ ัะพะณะปะฐัะพะฒะฐะฝะฝะพััะธ ะผะธัะพะฒะพะทะทัะตะฝะธั

**ะัะตะผั ะฟัะพะฒะตัะบะธ**: $(date '+%Y-%m-%d %H:%M:%S')
**ะะฑัะตะบั ะฟัะพะฒะตัะบะธ**: ะะธัะตะบัะพัะธั spec/knowledge/ ะธ ะฝะฐะฟะธัะฐะฝะฝัะต ะณะปะฐะฒั
**ะะฑะปะฐััั ะฟัะพะฒะตัะบะธ**: ะะฐัััะพะนะบะธ ะผะธัะพะฒะพะทะทัะตะฝะธั, ะณะตะพะณัะฐัะธัะตัะบะฐั ะปะพะณะธะบะฐ, ะบัะปััััะฝัะต ะพะฑััะฐะธ, ัะฟะตัะธะฐะปัะฝัะต ะฟัะฐะฒะธะปะฐ

---

## ะฆะตะปะพััะฝะพััั ัะฐะนะปะพะฒ ะฝะฐัััะพะตะบ

- [$([ -f "$WORLD_SETTING" ] && echo "x" || echo " ")] CHK001 world-setting.md ัััะตััะฒัะตั
- [$([ -f "$LOCATIONS" ] && echo "x" || echo " ")] CHK002 locations.md ัััะตััะฒัะตั
- [$([ -f "$CULTURE" ] && echo "x" || echo " ")] CHK003 culture.md ัััะตััะฒัะตั
- [$([ -f "$RULES" ] && echo "x" || echo " ")] CHK004 rules.md ัััะตััะฒัะตั

## ะกะพะณะปะฐัะพะฒะฐะฝะฝะพััั ัะตัะผะธะฝะพะปะพะณะธะธ

- [$([ -d "$CONTENT_DIR" ] && echo "x" || echo " ")] CHK005 ะะฟัะตะดะตะปะตะฝะธั ะธะผะตะฝ ัะพะฑััะฒะตะฝะฝัั ะฟะพะปะฝั
- [ ] CHK006 ะขะตัะผะธะฝะพะปะพะณะธั ะฒ ะณะปะฐะฒะฐั ัะพะพัะฒะตัััะฒัะตั ะดะพะบัะผะตะฝัะฐัะธะธ ะผะธัะพะฒะพะทะทัะตะฝะธั (ััะตะฑัะตั ัััะฝะพะน ะฟัะพะฒะตัะบะธ)

## ะะตะพะณัะฐัะธัะตัะบะฐั ะปะพะณะธะบะฐ

EOF

    if [ -f "$LOCATIONS" ]; then
        local location_count=$(grep -c '^##' "$LOCATIONS" 2>/dev/null || echo 0)
        echo "- [x] CHK007 ะะฟัะตะดะตะปะตะฝะธะต ะปะพะบะฐัะธะน ะฟะพะปะฝะพ (ะพะฟัะตะดะตะปะตะฝะพ ${location_count} ะปะพะบะฐัะธะน)"
    else
        echo "- [ ] CHK007 ะะฟัะตะดะตะปะตะฝะธะต ะปะพะบะฐัะธะน ะฟะพะปะฝะพ"
    fi

    cat <<EOF
- [ ] CHK008 ะะฐัััะพัะฝะธั ะธ ะฝะฐะฟัะฐะฒะปะตะฝะธั ะผะตะถะดั ะปะพะบะฐัะธัะผะธ ัะฐะทัะผะฝั (ััะตะฑัะตั ัััะฝะพะน ะฟัะพะฒะตัะบะธ)
- [ ] CHK009 ะะตะพะณัะฐัะธัะตัะบะธะต ะพะฟะธัะฐะฝะธั ะฒ ะณะปะฐะฒะฐั ัะพะพัะฒะตัััะฒััั ะฝะฐัััะพะนะบะฐะผ (ััะตะฑัะตั ัััะฝะพะน ะฟัะพะฒะตัะบะธ)

## ะัะปััััะฝะฐั ัะพะณะปะฐัะพะฒะฐะฝะฝะพััั

EOF

    if [ -f "$CULTURE" ]; then
        local culture_count=$(grep -c '^##' "$CULTURE" 2>/dev/null || echo 0)
        echo "- [x] CHK010 ะะฟัะตะดะตะปะตะฝะธะต ะบัะปััััะฝัั ัะปะตะผะตะฝัะพะฒ ะฟะพะปะฝะพ (ะพะฟัะตะดะตะปะตะฝะพ ${culture_count} ัะปะตะผะตะฝัะพะฒ)"
    else
        echo "- [ ] CHK010 ะะฟัะตะดะตะปะตะฝะธะต ะบัะปััััะฝัั ัะปะตะผะตะฝัะพะฒ ะฟะพะปะฝะพ"
    fi

    cat <<EOF
- [ ] CHK011 ะะฟะธัะฐะฝะธั ะพะฑััะฐะตะฒ ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝั (ััะตะฑัะตั ัััะฝะพะน ะฟัะพะฒะตัะบะธ)
- [ ] CHK012 ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะทัะบะฐ ะธ ะพะฑัะฐัะตะฝะธะน ะตะดะธะฝะพะพะฑัะฐะทะฝะพ (ััะตะฑัะตั ัััะฝะพะน ะฟัะพะฒะตัะบะธ)

## ะกะพะณะปะฐัะพะฒะฐะฝะฝะพััั ะฟัะฐะฒะธะป

EOF

    if [ -f "$RULES" ]; then
        local rule_count=$(grep -c '^##' "$RULES" 2>/dev/null || echo 0)
        echo "- [x] CHK013 ะะฟัะตะดะตะปะตะฝะธะต ัะฟะตัะธะฐะปัะฝัั ะฟัะฐะฒะธะป ะฟะพะปะฝะพ (ะพะฟัะตะดะตะปะตะฝะพ ${rule_count} ะฟัะฐะฒะธะป)"
    else
        echo "- [ ] CHK013 ะะฟัะตะดะตะปะตะฝะธะต ัะฟะตัะธะฐะปัะฝัั ะฟัะฐะฒะธะป ะฟะพะปะฝะพ"
    fi

    cat <<EOF
- [ ] CHK014 ะัะธะผะตะฝะตะฝะธะต ะฟัะฐะฒะธะป ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ (ััะตะฑัะตั ัััะฝะพะน ะฟัะพะฒะตัะบะธ)
- [ ] CHK015 ะัะฐะฒะธะปะฐ ะฝะต ะฟัะพัะธะฒะพัะตัะฐั ะดััะณ ะดััะณั (ััะตะฑัะตั ัััะฝะพะน ะฟัะพะฒะตัะบะธ)

---

## ะะฑะฝะฐััะถะตะฝะฝัะต ะฟัะพะฑะปะตะผั

EOF

    if [ ${#ISSUES[@]} -gt 0 ]; then
        for issue in "${ISSUES[@]}"; do
            IFS='|' read -r name msg <<< "$issue"
            echo "### $name"
            echo ""
            echo "**ะัะพะฑะปะตะผะฐ**: $msg"
            echo ""
        done
    else
        echo "*ะัะพะฑะปะตะผ ะฝะต ะพะฑะฝะฐััะถะตะฝะพ*"
    fi

    cat <<EOF

---

## ะกัะฐัะธััะธะบะฐ ะฟัะพะฒะตัะบะธ

- **ะัะตะณะพ ะฟัะพะฒะตัะพะบ**: ${TOTAL_CHECKS}
- **ะัะพะนะดะตะฝะพ**: ${PASSED_CHECKS}
- **ะขัะตะฑัะตััั ัะปัััะตะฝะธะต**: ${ERRORS}
- **ะัะตะดัะฟัะตะถะดะตะฝะธะน**: ${WARNINGS}

---

## ะะฐะปัะฝะตะนัะธะต ะดะตะนััะฒะธั

- [ ] ะะพะฟะพะปะฝะธัั ะฝะตะดะพััะฐััะธะต ะดะพะบัะผะตะฝัั ั ะฝะฐัััะพะนะบะฐะผะธ
- [ ] ะกะพะทะดะฐัั ะณะปะพััะฐัะธะน ะดะปั ะทะฐะฟะธัะธ ะธะผะตะฝ ัะพะฑััะฒะตะฝะฝัั
- [ ] ะัััะฝัั ะฟัะพะฒะตัะธัั ะพะฟะธัะฐะฝะธั ะผะธัะพะฒะพะทะทัะตะฝะธั ะฒ ะณะปะฐะฒะฐั
- [ ] ะะฐะฟะธัะฐัั ัะฐัััะพัะฝะธั ะธ ะฒัะตะผั ะฒ ะฟััะธ ะผะตะถะดั ะปะพะบะฐัะธัะผะธ

---

**ะะฝััััะผะตะฝั ะฟัะพะฒะตัะบะธ**: check-world.sh
**ะะตััะธั**: 1.0
EOF
}

# ะัะฝะพะฒะฝะฐั ััะฝะบัะธั
main() {
    if [ "$CHECKLIST_MODE" = true ]; then
        output_checklist
    else
        generate_report
    fi

    # ะะพะทะฒัะฐั ัะพะพัะฒะตัััะฒัััะตะณะพ ะบะพะดะฐ ะฒััะพะดะฐ ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ัะตะทัะปััะฐัะพะฒ
    if [ "$ERRORS" -gt 0 ]; then
        exit 1
    else
        exit 0
    fi
}

# ะัะฟะพะปะฝะตะฝะธะต ะพัะฝะพะฒะฝะพะน ััะฝะบัะธะธ
main